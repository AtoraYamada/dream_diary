# 演出仕様

全画面共通の演出定義。各画面の仕様書から参照される。
SE名はアセットリスト（`docs/dream_diary_asset_list.md`）を参照。

---

## 画面構成（全画面共通）

### 4:3 ビューポート

- メイン画面は **4:3（320x240基準）** を維持し、ブラウザ中央に配置

### 額縁（余白）

- 4:3画面の外側には「暗い石壁」を配置
- 全画面共通の最背面として世界観を補強

---

## 質感演出（PS1フィルタ）

全画面に適用するレトロ質感。

| 項目 | 説明 |
|------|------|
| 解像度 | 低解像度レンダリング、エッジを際立たせる |
| ディザリング | グラデーションにディザリング処理 |
| ジッター | 特定オブジェクトに微細な不規則揺れ |
| ポストプロセス | コントラスト・明度・セピア調整を一括適用 |

**注力ポイント**: 複雑な3D挙動よりも、CSSアニメーションの「イージング」や「SE同期」に注力し、低コストで高い没入感を実現。

---

## 汎用演出

### 瞬き演出

画面遷移・モーダル切替時の視覚効果。

| フェーズ | 時間 | 説明 | SE |
|----------|------|------|-----|
| 閉眼 | 300ms | 上下から黒いまぶたが閉じる | sfx_blink.wav |
| 暗転 | 可変 | 処理実行（遷移・API呼出等） | - |
| 開眼 | 300ms | まぶたが開く | - |

**CSS**: `.blink-closing`, `.blink-opening`

---

### 選択・決定

| 演出 | SE | 説明 |
|------|-----|------|
| UIボタン押下 | sfx_ui_confirm.wav | 世界観に合う「コッ」という短い木製音 |

---

### 画面スライド

| 演出 | SE | 説明 |
|------|-----|------|
| 本棚ページネーション | sfx_screen_slide.wav | 重く乾いた音 |

---

### 保存失敗

| 演出 | SE | 説明 |
|------|-----|------|
| API失敗時 | sfx_glitch_dissonance.wav | 世界による「拒絶」を表現する短い電子ノイズ |

---

### 通信中

| 演出 | 説明 |
|------|------|
| 巻物が震える | API通信中の視覚フィードバック |

---

## 巻物演出

夢作成・編集画面で使用。

| 演出 | 時間 | 説明 | SE |
|------|------|------|-----|
| 展開 | 400ms | 高さ 0 → 100% | sfx_scroll_unfurl.wav |
| 収束 | 300ms | 高さ 100% → 0 | sfx_scroll_roll_up.wav |

---

## 本の演出

作成・編集・一覧・詳細画面で使用。

| 演出 | 時間 | 説明 | SE |
|------|------|------|-----|
| 実体化（閉本） | 200ms | 半開き → 閉 | sfx_book_close_heavy.wav |
| 開く | 300ms | 閉 → 半開き → 見開き | sfx_page_turn.wav |
| 閉じる | 400ms | 見開き → 半開き → 閉 | sfx_book_close_heavy.wav |
| 本棚へ飛翔 | 400ms | 縮小しながら移動 | sfx_book_vanish.wav |

---

## トップページ

| 演出 | 時間 | 内容 | SE |
|------|------|------|-----|
| 扉クリック | - | ズーム + 瞬き → 認証画面へ | sfx_door_open_heavy.wav |
| 入力中 | ループ | 鉛筆カーソル + 筆記音 | sfx_pencil_write.wav |

---

## 認証画面

| 演出 | 時間 | 内容 | SE |
|------|------|------|-----|
| タブ切替 | 300ms | カードスライド | sfx_auth_card_slide.wav |
| 認証成功 | 800ms | 瞬き + 書斎へ遷移 | sfx_boundary_pass.wav |
| 認証失敗 | 800ms | 砂崩れ | sfx_sand_crumble.wav |

---

## 書斎（メインハブ）

| 演出 | 説明 | SE |
|------|------|-----|
| 環境音 | 常時ループ（時計の秒針、遠くの風、木の軋み） | sfx_library_ambience.mp3 |
| ズーム移動 | 本棚・索引箱へ接近・離反 | sfx_zoom_in_out.wav |

---

## 作成・編集画面

| 演出 | 説明 | SE |
|------|------|-----|
| 感情選択 | インクが滴る | sfx_ink_drip.wav |
| 入力中 | 羽ペン筆記音（ループ） | sfx_quill_write.wav |

---

## 定着の儀式（新規作成・保存成功）

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 200ms | 銀の栞が発光 | - |
| 2 | 300ms | 巻物が縮小 | sfx_scroll_roll_up.wav |
| 3 | 300ms | 瞬き（閉眼） | sfx_blink.wav |
| 4 | - | 暗転中に本が実体化 | - |
| 5 | 500ms | 瞬き（開眼） | - |
| 6 | 600ms | 本実体化（半開き→閉） | sfx_book_close_heavy.wav |
| 7 | 400ms | 本が本棚へ飛翔 | sfx_book_vanish.wav |
| 8 | 300ms | モーダル閉じ | - |

**合計**: 約2900ms

---

## 定着の儀式（更新・保存成功）

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 300ms | 巻物が縮小 | sfx_scroll_roll_up.wav |
| 2 | 300ms | 瞬き（閉眼） | sfx_blink.wav |
| 3 | 600ms | 暗転中に本実体化 | sfx_book_close_heavy.wav |
| 4 | 400ms | 本が暗闇に消える | - |
| 5 | 500ms | 瞬き（開眼）で一覧へ | - |
| 6 | 300ms | 背表紙が光る | sfx_highlight.wav |

**合計**: 約2400ms
**遷移後**: URLパラメータ `?highlight=:id` で該当背表紙を光らせる

---

## 忘却の儀式（削除）

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 1000ms | 砂時計逆回転 | sfx_hourglass_rotate.wav |
| 2 | 800ms | 文字がインクのように霧散 | sfx_ink_dissipate.wav |
| 3 | 500ms | 本がフェードアウト | sfx_book_vanish.wav |
| 4 | - | 確認なし（削除実行済み） | - |
| 5 | 2000ms後、400ms | 隣の本がスライドして埋める | - |

**合計**: 約4700ms

---

## 本を開く / 閉じる（詳細画面）

### 開く

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 800ms | 瞬き | sfx_blink.wav |
| 2 | 300ms | 背景ぼかし | - |
| 3 | 800ms | 本開き（閉→半開き→見開き） | sfx_page_turn.wav |

### 閉じる

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 400ms | 本閉じ（見開き→半開き→閉） | sfx_book_close_heavy.wav |
| 2 | 300ms | 本棚へ戻る | - |

**注意**: 閉じる時は瞬き不要

---

## ページめくり（詳細画面）

見開き本の左右ページ切替。

| フェーズ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 回転開始 | 0ms | rotateY アニメーション開始 | sfx_page_turn.wav |
| 中間地点 | 400ms | ページ内容更新（回転中で見えない） | - |
| 回転完了 | 800ms | 新ページ表示 | - |

**CSS**: `transform: rotateY(±180deg)`

---

## 索引箱（検索）

| 演出 | 時間 | 内容 | SE |
|------|------|------|-----|
| 箱を開く | 400ms | 蓋が開く | sfx_index_box_open_close.wav |
| カード表示 | 200ms | タグカードフェードイン | - |
| カードめくり | - | タグカード切替 | sfx_tag_card_flip.wav |
| ピン留め | - | タグ選択 | sfx_pin.wav |
| カード削除 | 500ms | 紙片崩壊 | sfx_sand_crumble.wav |
| 箱を閉じる | 300ms | 蓋が閉まる | sfx_index_box_open_close.wav |

---

## 夢の氾濫（特殊演出）

書斎の窓から過去の夢が溢れ出す演出。

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 500ms | 窓が歪む | sfx_glass_warp.wav |
| 2 | 1000ms | 断片文字が流入 | - |
| 3 | 300ms | 鏡文字で表示 | - |

**API**: `GET /api/v1/dreams/overflow`
**ユーザーアクション**: テキストホバーで正像に反転

---

## 目覚めの儀式（ログアウト）

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | - | 鏡クリック | - |
| 2 | 300ms | 第1の瞬き（閉眼） | sfx_boundary_pass.wav |
| 3 | - | 覚醒の兆候: トップページの森がぼかし状態で表示 | - |
| 4 | 300ms | 第2の瞬き（開眼） | - |
| 5 | - | トップページへ遷移 | - |

---

## ホバー効果

### 背表紙ホバー

| 演出 | 時間 | 内容 |
|------|------|------|
| ホバー開始 | 300ms | タイトル浮遊表示 |
| リフト | 300ms | scale(1.03) translateY(-5px) |
| ホバー終了 | 300ms | 元に戻る |

### タグカードホバー

| 演出 | SE |
|------|-----|
| ホバー | sfx_tag_card_flip.wav |

---

## 実装状況

- [ ] 4:3ビューポート
- [ ] 額縁（石壁）
- [ ] PS1フィルタ（質感演出）
- [ ] 瞬き演出
- [ ] 選択・決定音
- [ ] 画面スライド
- [ ] 保存失敗演出
- [ ] 通信中演出
- [ ] 巻物演出
- [ ] 本の演出
- [ ] トップページ演出
- [ ] 認証画面演出
- [ ] 書斎環境音
- [ ] 作成・編集画面演出
- [ ] 定着の儀式（新規）
- [ ] 定着の儀式（更新）
- [ ] 忘却の儀式
- [ ] 本を開く/閉じる
- [ ] ページめくり
- [ ] 索引箱演出
- [ ] 夢の氾濫
- [ ] 目覚めの儀式
- [ ] ホバー効果
