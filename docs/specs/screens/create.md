# 夢作成画面（夢を編む）

巻物スクロールに直接文字を書き込む没入型UI。背景は書斎（ぼかし）。

---

## 画面構成

| 要素 | 説明 |
|------|------|
| 背景 | 書斎（ぼかし） |
| 巻物モーダル | 上端画像 + 入力エリア + 下端画像 |
| 羽ペンカーソル | 入力中のカーソル |
| インク瓶（4色） | 感情彩色選択（平穏・混沌・恐怖・高揚） |
| 銀の栞 | 保存ボタン |

---

## 入力フィールド

| フィールド | 必須 | 制約 | 説明 |
|------------|------|------|------|
| タイトル | ○ | 最大15文字 | リアルタイム文字数表示 |
| 夢を見た日 | ○ | 日付 | デフォルト: 現在日付 |
| 本文 | ○ | 最大10,000文字 | リアルタイム文字数表示 |
| 明晰夢 | - | boolean | 「これは夢だと気づいていたか」 |
| タグ | - | 複数可 | 登場人物・場所の2カテゴリ |

制約詳細は `data.md` 参照。

---

## UI動作

### データ読み込み

| 条件 | 動作 |
|------|------|
| LocalStorageあり | 殴り書きメモを本文に自動入力 |
| LocalStorageなし | 空の状態で開始 |

### タグ入力

| 操作 | 動作 |
|------|------|
| 入力開始 | サジェスト表示（debounce 300ms） |
| タグ選択/確定 | バッジ追加 |
| ×クリック | タグ削除 |

### 感情彩色選択

| 操作 | 動作 |
|------|------|
| インク瓶クリック | sfx_ink_drip.wav + 巻物の紙色変化 |

### 保存

| 操作 | 動作 |
|------|------|
| 銀の栞クリック | 定着の儀式開始 |
| 通信中 | 巻物が震える |
| 成功 | 定着の儀式 → 書斎復帰 |
| 失敗 | sfx_glitch_dissonance.wav + エラー表示 |

---

## エラーハンドリング

バリデーションエラーメッセージは `config/locales/ja.yml` 参照。

| 状況 | 対応 |
|------|------|
| バリデーションエラー | エラーメッセージ表示 |
| 通信エラー | LocalStorage退避（`lost_dream_fragment`）+ クリップボードコピーボタン |

---

## API

### 夢作成

**エンドポイント**: `POST /api/v1/dreams`

**リクエスト**:
```json
{
  "dream": {
    "title": "夢のタイトル",
    "content": "夢の本文...",
    "emotion_color": "peace",
    "lucid_dream_flag": false,
    "dreamed_at": "2025-01-15",
    "tag_attributes": [
      { "name": "田中", "yomi": "たなか", "category": "person" },
      { "name": "学校", "yomi": "がっこう", "category": "place" }
    ]
  }
}
```

**レスポンス（成功: 201）**: 作成された夢データ

**レスポンス（失敗: 422）**: エラーメッセージ

### タグサジェスト

**エンドポイント**: `GET /api/v1/tags/suggest`

**クエリパラメータ**:
| パラメータ | 型 | 説明 |
|-----------|-----|------|
| q | string | 検索クエリ |
| category | string | person / place |

---

## 演出

`animations.md` 参照。

- 巻物演出（展開・収束）
- 作成・編集画面（感情選択、羽ペン筆記音）
- 定着の儀式（新規作成・保存成功）
- 通信中（巻物が震える）
- 保存失敗

---

## 実装状況

- [ ] 巻物モーダルUI
- [ ] 入力フォーム
- [ ] インク瓶（感情彩色選択）
- [ ] タグ入力・サジェスト
- [ ] LocalStorage読み込み
- [ ] 羽ペンカーソル・筆記音
- [ ] 定着の儀式（保存成功演出）
- [ ] 通信中・保存失敗演出
- [ ] エラーハンドリング
