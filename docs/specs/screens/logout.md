# 目覚めの儀式（ログアウト）

書斎の鏡をクリックでログアウト。「夢から覚める」演出を経て、トップページ（現実）へ戻る。

---

## 要件

- 書斎の鏡クリックで発動
- 2段階の瞬き演出（覚醒の兆候→完全な覚醒）
- ログアウト処理
- トップページへ遷移
- LocalStorageは保持（scratch_memo）

---

## 設計判断

| 項目 | 選択 | 理由 |
|------|------|------|
| トリガー | 鏡のクリック | 「鏡の中の自分」＝「現実の自分」を表現 |
| 演出 | 2段階の瞬き | 夢から覚める過程を段階的に表現 |
| LocalStorage | 保持 | ログアウト後もメモを残す |
| セッション管理 | Devise標準 | セキュアなログアウト処理 |

---

## 画面構成

| レイヤー | 要素 | 説明 |
|---------|------|------|
| 背景 | 書斎背景 | bg_library_desk.png |
| 前景 | 鏡 | クリックトリガー |

---

## UI動作

### 目覚めの儀式（ログアウト）

**トリガー**: 書斎の鏡をクリック

**動作**:
1. 鏡の反応（即時）
   - 鏡が光る（ホバー時の演出継続）
2. 第1の瞬き（200ms）
   - 暗転
   - SE: `sfx_blink.wav`、`sfx_boundary_pass.wav`
3. 覚醒の兆候（1000ms）
   - トップページの森がぼかし状態で表示
   - 霞がかった状態
4. 第2の瞬き（200ms）
   - 再度瞬き演出
   - SE: `sfx_blink.wav`
5. 完全な覚醒（即時）
   - ピントが合ったトップページが表示
   - 操作可能に

**結果**:
- ログアウト処理が実行される
- トップページ（top.md）へ戻る
- LocalStorage（scratch_memo）は保持される

---

## エラーハンドリング

| 状況 | 対応 |
|------|------|
| ログアウト失敗 | エラーメッセージ表示、書斎に留まる |

エラーメッセージは `config/locales/ja.yml` 参照。

---

## データ送受信（API）

### ログアウト

**エンドポイント**: `DELETE /users/sign_out`

**レスポンス（成功: 200）**:
```json
{
  "message": "Logged out successfully."
}
```

**レスポンス（失敗: 401）**:
```json
{
  "error": "エラーメッセージ"
}
```

**補足**: Devise未実装（JSON API化未対応）

---

## 演出

`animations.md` の以下のセクションを参照：
- 目覚めの儀式（ログアウト）

**演出詳細**:
1. 鏡が光る（ホバー時の演出継続）
2. 第1の瞬き（暗転）: `sfx_blink.wav`, `sfx_boundary_pass.wav`
3. 覚醒の兆候（トップページの森がぼかし状態で表示、1000ms）
4. 第2の瞬き（再度暗転）: `sfx_blink.wav`
5. 完全な覚醒（ピントが合ったトップページ表示）

**合計時間**: 約1400ms

---

## 実装状況

### バックエンド（API）

- [ ] DELETE /users/sign_out（Devise Sessions#destroy）
- [ ] JSON API化

### フロントエンド

- [ ] JavaScript（app/javascript/logout.js）
- [ ] CSS（app/assets/stylesheets/logout.css）
- [ ] 鏡クリックトリガー
- [ ] ログアウトAPI連携
- [ ] 第1の瞬き演出
- [ ] 覚醒の兆候演出（ぼかし状態）
- [ ] 第2の瞬き演出
- [ ] 完全な覚醒演出（ピント調整）
- [ ] トップページへ遷移
- [ ] LocalStorage保持確認
- [ ] エラーハンドリング
- [ ] 演出・SE再生

**Note**: プロトタイプ（`prototype/`）に参考実装あり。Rails本体への統合が必要。
