# 検索画面（索引箱）

書斎の索引箱をクリックして開く検索モーダル。タグ検索とキーワード検索を提供。

---

## 画面構成

| 要素 | 説明 |
|------|------|
| 背景 | 書斎（ぼかし） |
| 索引箱内装 | img_index_box_interior.png をフレームとして表示 |
| ヘッダー | 選択中タグのバッジ表示、タグ絞り込み窓、タイトル・本文検索窓 |
| カードリスト | 全タグがカードで表示（五十音順） |
| インデックス | 右端に「あ」「か」「さ」…「英」「他」の真鍮製プレート |
| フッター | 「抽出」「開架」ボタン |

---

## UI動作

### タグ選択

| 操作 | 動作 |
|------|------|
| タグカードクリック | ピン留め（sfx_pin.wav）、ヘッダーにバッジ追加 |
| タグカードホバー | sfx_tag_card_flip.wav |
| バッジ「×」クリック | 選択解除 |

### タグ絞り込み

| 操作 | 動作 |
|------|------|
| 絞り込み窓入力 | 表示名・読みがな両方で検索 |
| インデックスクリック | 該当行へスクロール |

### キーワード検索

| フィールド | 対象 | 説明 |
|------------|------|------|
| キーワード | タイトル・本文 | スペース区切りでAND検索 |

### 検索実行

| 操作 | 動作 |
|------|------|
| 「抽出」クリック | 瞬き → 本棚に結果表示 |
| 「開架」クリック | 瞬き → 全表示に戻る（リセット） |
| 外側クリック | 索引箱閉じ → 書斎へ戻る |

### タグ削除

| 操作 | 動作 |
|------|------|
| タグカード右下「破れた紙片」クリック | 風化アニメーションで消滅 |

---

## エラーハンドリング

エラーメッセージは `config/locales/ja.yml` 参照。

| 状況 | 対応 |
|------|------|
| 検索結果なし | 「該当する夢が見つかりません」表示 |
| 通信エラー | sfx_glitch_dissonance.wav + エラーメッセージ表示 |

---

## API

### タグ一覧取得

**エンドポイント**: `GET /api/v1/tags`

**クエリパラメータ**:
| パラメータ | 型 | 説明 |
|-----------|-----|------|
| category | string | person / place（省略時: 全カテゴリ） |

**レスポンス（成功: 200）**:
```json
{
  "tags": [
    { "id": 1, "name": "田中", "yomi": "たなか", "yomi_index": "た", "category": "person" }
  ]
}
```

### 夢検索

**エンドポイント**: `GET /api/v1/dreams/search`

**クエリパラメータ**:
| パラメータ | 型 | 説明 |
|-----------|-----|------|
| keyword | string | タイトル・本文のAND検索（スペース区切り） |
| tag_ids | array | タグIDの配列 |
| page | integer | ページ番号 |

**レスポンス**: 一覧画面と同一フォーマット

### タグ削除

**エンドポイント**: `DELETE /api/v1/tags/:id`

**レスポンス（成功: 204）**: No Content

---

## 演出

`animations.md` 索引箱（検索）参照。

- 箱を開く / 閉じる
- カード表示・めくり
- ピン留め
- カード削除（風化）

---

## 実装状況

- [ ] 索引箱内装UI
- [ ] ヘッダー（バッジ・絞り込み・検索窓）
- [ ] タグカード表示（五十音順）
- [ ] インデックス（五十音ジャンプ）
- [ ] タグ選択・解除
- [ ] キーワード検索
- [ ] 抽出・開架ボタン
- [ ] タグ削除
- [ ] 索引箱演出
- [ ] エラーハンドリング
