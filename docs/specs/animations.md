# 演出仕様

全画面共通の演出定義。各画面の仕様書から参照される。
SE名はアセットリスト（`docs/dream_diary_asset_list.md`）を参照。

---

## 画面構成（全画面共通）

### 4:3 ビューポート

- メイン画面は **4:3（320x240基準）** を維持し、ブラウザ中央に配置

### 額縁（余白）

- 4:3画面の外側には「暗い石壁」（`bg_stone_wall_dark.png`）を配置
- 全画面共通の最背面として世界観を補強

---

## 質感演出（PS1フィルタ）

全画面に適用するレトロ質感。

| 項目 | 説明 |
|------|------|
| 解像度 | 低解像度レンダリング、エッジを際立たせる |
| ディザリング | グラデーションにディザリング処理 |
| ジッター | 特定オブジェクトに微細な不規則揺れ |
| ポストプロセス | コントラスト・明度・セピア調整を一括適用 |

**注力ポイント**: 複雑な3D挙動よりも、CSSアニメーションの「イージング」や「SE同期」に注力し、低コストで高い没入感を実現。

---

## 汎用演出

### 瞬き演出

画面遷移・モーダル切替時の視覚効果。

| フェーズ | 時間 | 説明 | SE |
|----------|------|------|-----|
| 閉眼 | 300ms | 上下から黒いまぶたが閉じる | sfx_blink.wav |
| 暗転 | 可変 | 処理実行（遷移・API呼出等） | - |
| 開眼 | 300ms | まぶたが開く | - |

**CSS**: `.blink-closing`, `.blink-opening`

---

### 選択・決定

| 演出 | SE | 説明 |
|------|-----|------|
| UIボタン押下 | sfx_ui_confirm.wav | 世界観に合う「コッ」という短い木製音 |

---

### 画面スライド

| 演出 | SE | 説明 |
|------|-----|------|
| 本棚ページネーション | sfx_screen_slide.wav | 重く乾いた音 |

---

### 通信中

| 演出 | 説明 |
|------|------|
| 巻物が震える | API通信中の視覚フィードバック |

---

### 保存失敗時の救済処理

#### 通信中の演出

- 巻物が震える

#### 失敗時の演出

| ステップ | 内容 | SE |
|----------|------|-----|
| 1 | PS1風ノイズ演出 | sfx_glitch_dissonance.wav |
| 2 | エラーメッセージ表示「記憶が定着しません。霧が深すぎます。」 | - |
| 3 | モーダルは開いたまま、フォームデータ保持 | - |

#### 救済機能

| 機能 | 説明 |
|------|------|
| LocalStorage保持 | 自動保存されたデータは保持される（再試行可能） |
| 再試行 | ユーザーは再度保存ボタンをクリック可能 |
| クリップボードコピー | 最終救済：フォーム内容をクリップボードへコピーするボタン表示 |

#### 自動保存

| 画面 | LocalStorageキー | タイミング |
|------|-----------------|-----------|
| 作成画面 | `scratch_memo` | 入力ごと（トップページと共有） |
| 編集画面 | `draft_dream_edit_{id}` | 入力ごと（保存成功時に削除） |

---

## 巻物演出

夢作成・編集画面で使用。

| 演出 | 時間 | 説明 | SE |
|------|------|------|-----|
| 展開 | 400ms | 高さ 0 → 100% | sfx_scroll_unfurl.wav |
| 収束 | 300ms | 高さ 100% → 0 | sfx_scroll_roll_up.wav |

---

## 本の演出

作成・編集・一覧・詳細画面で使用。

| 演出 | 時間 | 説明 | SE |
|------|------|------|-----|
| 実体化（閉本） | 200ms | 半開き → 閉 | sfx_book_close_heavy.wav |
| 開く | 300ms | 閉 → 半開き → 見開き | sfx_page_turn.wav |
| 閉じる | 400ms | 見開き → 半開き → 閉 | sfx_book_close_heavy.wav |
| 本棚へ飛翔 | 400ms | 縮小しながら移動 | sfx_book_vanish.wav |

---

## トップページ

### 紙片の展開

**トリガー**: 紙片（`img_scratchpad_paper.png`）をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 500ms | 紙片が画面中央へ移動・拡大 | - |
| 2 | - | 背景が減光 | - |
| 3 | - | 入力可能状態になる | - |

**結果**: カーソルが「鉛筆」に変化（`cursor_pencil.png`）

### テキスト入力

**トリガー**: 入力エリアにフォーカス

| 演出 | 説明 | SE |
|------|------|-----|
| カーソル変化 | 鉛筆カーソルに変化 | - |
| 筆記音 | フォーカス中のみループ再生 | sfx_pencil_write.wav |
| 自動保存 | 1文字入力ごとにLocalStorageへ保存 | - |

### 紙片を閉じる

**トリガー**: 閉じるボタンをクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 500ms | 紙片が元の位置へ縮小・移動 | - |
| 2 | - | 背景の減光解除 | - |

**結果**: LocalStorageの内容は保持

### 扉をクリック（認証画面へ遷移）

**トリガー**: 森の扉をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 即時 | AudioContext有効化 | - |
| 2 | 600ms | 共通演出：瞬き | sfx_blink.wav |
| 3 | 瞬き中 | 扉の開閉音 | sfx_door_open_heavy.wav |

**結果**: 認証画面へ遷移

---

## 認証画面

### カード切り替え（ログイン⇔サインアップ）

**トリガー**: 背面に見えているカードをクリック

**初期表示**: ログインカードが前面、サインアップカードが背面にズレて重なる

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 300ms | クリックされたカードが前面に移動 | sfx_auth_card_slide.wav |
| 2 | 300ms | 前面にあったカードが背面に移動 | - |

**結果**: ログイン⇔サインアップフォームが切り替わる

### ログイン成功

**トリガー**: ログインボタンをクリック、認証成功

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 600ms | 共通演出：瞬き | sfx_blink.wav |
| 2 | 瞬き中 | 境界を越える音（澄んだチャイム） | sfx_boundary_pass.wav |

**結果**: 書斎画面へ遷移

### 認証エラー

**トリガー**: ログイン失敗、サインアップ失敗

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 500ms | 入力文字が砂のように崩れ落ちる | sfx_sand_crumble.wav |
| 2 | 即時 | エラーメッセージ表示 | - |

**結果**: 入力フィールドがクリアされ、再入力可能状態

### 戻るボタン

**トリガー**: 左上の戻るボタン（`icon_back.png`）をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 600ms | 共通演出：瞬き | sfx_blink.wav |

**結果**: トップページへ戻る

---

## 書斎（メインハブ）

### 環境音

| 演出 | 説明 | SE |
|------|------|-----|
| 常時ループ | 時計の秒針、遠くの風、木の軋み | sfx_library_ambience.mp3 |

### 縮小版巻物をクリック（作成画面へ）

**トリガー**: 机上の縮小版巻物をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 600ms | 共通演出：瞬き | sfx_blink.wav |
| 2 | 瞬き中 | 縮小版巻物が非表示、背景がぼかし状態に | - |
| 3 | 瞬き明転 | 閉じた状態の巻物が表示される | - |
| 4 | 400ms | 共通演出：巻物展開 | sfx_scroll_unfurl.wav |

**結果**: 作成画面がモーダル表示される

### 本棚をクリック（一覧画面へ）

**トリガー**: 本棚オブジェクトをクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 300ms | 本棚へズームイン | sfx_zoom_in_out.wav |
| 2 | 600ms | 共通演出：瞬き | sfx_blink.wav |

**結果**: 一覧画面へ遷移

### ホバー効果

| オブジェクト | 演出 |
|-------------|------|
| 巻物 | 発光 |
| 本棚 | 発光 |
| 窓 | 七色に光りながら楕円が収縮 |
| 鏡 | 黄色く白く光りながら楕円が収縮 |

---

## 作成画面

### テキスト入力

**トリガー**: 入力エリアにフォーカス

| 演出 | 説明 | SE |
|------|------|-----|
| カーソル変化 | 羽ペンカーソルに変化 | - |
| 筆記音 | フォーカス中のみループ再生 | sfx_quill_write.wav |
| 自動保存 | 入力ごとにLocalStorageへ自動保存（`scratch_memo`） | - |

### 感情彩色の選択

**トリガー**: インク瓶（`img_ink_bottle_*.png`）をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 即時 | インクの滴り音 | sfx_ink_drip.wav |
| 2 | 即時 | 巻物の紙色が変更 | - |

**結果**: 選択した感情彩色に応じて巻物の背景色が変化

### 保存せずに閉じる（画面外クリック）

**トリガー**: 巻物の外側（画面外）をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 300ms | 共通演出：巻物収束 | sfx_scroll_roll_up.wav |
| 2 | 600ms | 共通演出：瞬き | sfx_blink.wav |
| 3 | 瞬き中 | 縮小版巻物が再表示される | - |
| 4 | 瞬き明転 | 書斎画面が表示される | - |

**結果**: 書斎画面に戻る（LocalStorageは保持）

---

## 編集画面

### テキスト入力

**トリガー**: 入力エリアにフォーカス

| 演出 | 説明 | SE |
|------|------|-----|
| カーソル変化 | 羽ペンカーソルに変化 | - |
| 筆記音 | フォーカス中のみループ再生 | sfx_quill_write.wav |
| 自動保存 | 入力ごとにLocalStorageへ自動保存（`draft_dream_edit_{id}`） | - |

### 感情彩色の選択

**トリガー**: インク瓶（`img_ink_bottle_*.png`）をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 即時 | インクの滴り音 | sfx_ink_drip.wav |
| 2 | 即時 | 巻物の紙色が変更 | - |

**結果**: 選択した感情彩色に応じて巻物の背景色が変化

### 保存せずに閉じる（画面外クリック）

**トリガー**: 巻物の外側（画面外）をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 300ms | 共通演出：巻物収束 | sfx_scroll_roll_up.wav |
| 2 | 600ms | 共通演出：瞬き | sfx_blink.wav |
| 3 | 600ms | 本が開く（閉→半開き→見開き） | sfx_page_turn.wav |

**結果**: 詳細画面に戻る（LocalStorageの`draft_dream_edit_{id}`を削除）

---

## 定着の儀式（新規作成・保存成功）

**トリガー**: 銀の栞（`icon_bookmark_silver.png`）をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 200ms | 銀の栞が発光 | - |
| 2 | 300ms | 巻物が縮小 | sfx_scroll_roll_up.wav |
| 3 | 300ms | 瞬き（閉眼） | sfx_blink.wav |
| 4 | - | 暗転中に巻物が非表示、縮小版巻物が再表示、本が実体化 | - |
| 5 | 500ms | 瞬き（開眼） | - |
| 6 | 600ms | 本実体化（半開き→閉） | sfx_book_close_heavy.wav |
| 7 | 400ms | 本が本棚へ飛翔 | sfx_book_vanish.wav |
| 8 | 300ms | モーダル閉じ | - |

**合計**: 約2900ms

---

## 定着の儀式（更新・保存成功）

**トリガー**: 銀の栞（`icon_bookmark_silver.png`）をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 即時 | 銀の栞が発光 | - |
| 2 | 300ms | 巻物が縮小 | sfx_scroll_roll_up.wav |
| 3 | 300ms | 瞬き（閉眼） | sfx_blink.wav |
| 4 | 600ms | 暗転中に本実体化（半開き→閉） | sfx_book_close_heavy.wav |
| 5 | 即時 | 本が暗闇に消える | - |
| 6 | 500ms | 瞬き（開眼）で一覧へ | - |
| 7 | 即時 | 背表紙の再表示（フェードイン） | - |
| 8 | 即時 | 背表紙が光る（キラリと光る） | sfx_highlight.wav |

**合計**: 約2400ms
**遷移後**: URLパラメータ `?highlight=:id` で該当背表紙を光らせる

---

## 一覧画面（本棚）

### 背表紙ホバー / 1タップ（タイトル表示）

**トリガー**: 背表紙にホバー（PC）/ 1タップ（モバイル）

| 演出 | 時間 | 内容 |
|------|------|------|
| ホバー/1タップ | 300ms | タイトルが浮遊表示 |

### 背表紙クリック / 2タップ（詳細へ）

**トリガー**: 背表紙をクリック（PC）/ 2タップ（モバイル）

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 600ms | 共通演出：瞬き | sfx_blink.wav |
| 2 | 瞬き中 | クリックされた本の背表紙を非表示に | - |
| 3 | 即時 | 背景のぼかし（一覧画面が減光・ぼかし） | - |
| 4 | 600ms | 本が開く（閉→半開き→見開き） | sfx_page_turn.wav |

**結果**: 詳細画面がモーダル表示される

### ページネーション（左右端クリック）

**トリガー**: 画面左右端をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 600ms | 共通演出：瞬き（ラグ隠蔽） | sfx_blink.wav |
| 2 | 400ms | 共通演出：画面スライド | sfx_screen_slide.wav |

**結果**: 隣の本棚ページへ移動

### 索引箱をクリック（検索へ）

**トリガー**: 索引箱（`img_index_box_exterior.png`）をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 即時 | 索引箱の開閉音 | sfx_index_box_open_close.wav |
| 2 | 600ms | 共通演出：瞬き | sfx_blink.wav |

**結果**: 検索画面がモーダル表示される

### 戻るボタン（書斎へ）

**トリガー**: 左上の戻るボタン（`icon_back.png`）をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 300ms | ズームアウト | sfx_zoom_in_out.wav |
| 2 | 600ms | 共通演出：瞬き | sfx_blink.wav |

**結果**: 書斎画面へ戻る

---

## 詳細画面（本の閲覧）

### 編集トリガー（編集画面へ）

**トリガー**: 羽ペンとペーパーナイフ（`icon_edit_quill_knife.png`）をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 600ms | 本が閉じる（見開き→半開き→閉） | sfx_book_close_heavy.wav |
| 2 | 600ms | 共通演出：瞬き | sfx_blink.wav |
| 3 | 400ms | 共通演出：巻物展開 | sfx_scroll_unfurl.wav |

**結果**: 編集画面がモーダル表示される

### 本を閉じる（一覧へ戻る）

**トリガー**: 本の外側（画面外）をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 600ms | 本が閉じる（見開き→半開き→閉） | sfx_book_close_heavy.wav |
| 2 | 即時 | 背表紙の再表示（フェードイン） | - |

**結果**: モーダル閉じ、一覧画面に戻る（瞬き演出なし）

---

## 忘却の儀式（削除）

**トリガー**: アンティークな砂時計（`icon_hourglass_antique.png`）をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 1000ms | 砂時計逆回転 | sfx_hourglass_rotate.wav |
| 2 | 800ms | 文字がインクのように霧散 | sfx_ink_dissipate.wav |
| 3 | 500ms | 本がフェードアウト | sfx_book_vanish.wav |
| 4 | - | 確認なし（削除実行済み） | - |
| 5 | 2000ms後、400ms | 隣の本がスライドして埋める | - |

**合計**: 約4700ms

**特記事項**:
- **削除確認**: 砂時計クリック時に確認ダイアログを表示
- **取り消し不可**: 削除は取り消し不可であることを明示

---

## ページめくり（詳細画面）

**トリガー**: 左右ページをクリック

見開き本の左右ページ切替。

| フェーズ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 回転開始 | 0ms | rotateY アニメーション開始 | sfx_page_turn.wav |
| 中間地点 | 400ms | ページ内容更新（回転中で見えない） | - |
| 回転完了 | 800ms | 新ページ表示 | - |

**CSS**: `transform: rotateY(±180deg)`

---

## 索引箱（検索）

### タグカードをクリック（選択）

**トリガー**: タグカード（`img_tag_card_base.png`）をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 即時 | ピン留めアイコン表示 | sfx_pin.wav |

**結果**: タグが選択状態になり、ヘッダーにバッジ表示

### タグバッジの「×」クリック（選択解除）

**トリガー**: タグバッジの「×」をクリック

| 演出 | 内容 |
|------|------|
| タグバッジ解除 | ヘッダーのバッジから「×」をクリックで選択解除 |

**結果**: タグの選択が解除される

### タグ絞り込み

**トリガー**: タグ絞り込み窓に入力

| 機能 | 説明 |
|------|------|
| 絞り込み窓 | 表示名・読みがな両方で検索可能 |
| リアルタイム絞り込み | 入力に応じてカードリストが絞り込まれる |

### 五十音ジャンプ

**トリガー**: インデックス（「あ」「か」「さ」…）をクリック

| 演出 | 内容 |
|------|------|
| インデックスクリック | 該当行までカードリストがスクロール |

### タグカードホバー

**トリガー**: タグカードにホバー

| 演出 | SE |
|------|-----|
| ホバー | sfx_tag_card_flip.wav |

### タグ削除

**トリガー**: タグカード右下の「破れた紙片」（`img_tag_delete.png`）をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 800ms | タグカードが風化して消滅 | - |

**結果**: タグがDBから削除され、カードリストから消える

### 検索実行（「抽出」クリック）

**トリガー**: 「抽出」ボタンをクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 600ms | 共通演出：瞬き | sfx_blink.wav |

**結果**: 検索結果が一覧画面に表示される

### 検索リセット（「開架」クリック）

**トリガー**: 「開架」ボタンをクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 600ms | 共通演出：瞬き | sfx_blink.wav |

**結果**: 全表示に戻る

---

## 夢の氾濫（特殊演出）

書斎の窓から過去の夢が溢れ出す演出。

### 夢の氾濫開始

**トリガー**: 書斎の窓をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 500ms | 窓が歪む | sfx_glass_warp.wav |
| 2 | 1000ms | 文字が窓から流入（流入中の文字にランダムな感情彩色） | - |
| 3 | - | 画面中央に「鏡文字」として表示（統一色） | - |

**API**: `GET /api/v1/dreams/overflow`

### 文字の反転（ホバー/長押し）

**トリガー**: 鏡文字にホバー（PC）/ 長押し（モバイル）

| 演出 | 説明 |
|------|------|
| ホバー/長押し | 鏡文字が正像に反転 |

### 解除

**トリガー**: 背景クリック、または1分放置

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 500ms | 文字がフェードアウト | - |

**結果**: 書斎画面に戻る

---

## 目覚めの儀式（ログアウト）

**トリガー**: 書斎の鏡をクリック

| ステップ | 時間 | 内容 | SE |
|----------|------|------|-----|
| 1 | 即時 | 鏡が光る（ホバー時の演出継続） | - |
| 2 | 200ms | 第1の瞬き（暗転） | sfx_blink.wav, sfx_boundary_pass.wav |
| 3 | 1000ms | 覚醒の兆候（トップページの森がぼかし状態で表示） | - |
| 4 | 200ms | 第2の瞬き（再度暗転） | sfx_blink.wav |
| 5 | 即時 | 完全な覚醒（ピントが合ったトップページ表示） | - |

**結果**: ログアウト処理が実行され、トップページへ戻る

---

## ホバー効果

### 背表紙ホバー

| 演出 | 時間 | 内容 |
|------|------|------|
| ホバー開始 | 300ms | タイトル浮遊表示 |
| リフト | 300ms | scale(1.03) translateY(-5px) |
| ホバー終了 | 300ms | 元に戻る |

### タグカードホバー

| 演出 | SE |
|------|-----|
| ホバー | sfx_tag_card_flip.wav |

---

## 実装状況

- [ ] 4:3ビューポート
- [ ] 額縁（石壁）
- [ ] PS1フィルタ（質感演出）
- [ ] 瞬き演出
- [ ] 選択・決定音
- [ ] 画面スライド
- [ ] 保存失敗演出
- [ ] 通信中演出
- [ ] 巻物演出
- [ ] 本の演出
- [ ] トップページ演出
- [ ] 認証画面演出
- [ ] 書斎環境音
- [ ] 作成・編集画面演出
- [ ] 定着の儀式（新規）
- [ ] 定着の儀式（更新）
- [ ] 忘却の儀式
- [ ] 本を開く/閉じる
- [ ] ページめくり
- [ ] 索引箱演出
- [ ] 夢の氾濫
- [ ] 目覚めの儀式
- [ ] ホバー効果
