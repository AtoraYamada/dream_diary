# 夢編集画面（夢を編む）

巻物スクロールで既存の夢日記を編集。背景は一覧画面（ぼかし）。

---

## 画面構成

| 要素 | 説明 |
|------|------|
| 背景 | 一覧画面（ぼかし） |
| 巻物モーダル | 上端画像 + 入力エリア + 下端画像 |
| 羽ペンカーソル | 入力中のカーソル |
| インク瓶（4色） | 感情彩色選択（平穏・混沌・恐怖・高揚） |
| 銀の栞 | 保存ボタン |

---

## 入力フィールド

`screens/create.md` と同一。制約詳細は `data.md` 参照。

---

## UI動作

### データ読み込み

| 条件 | 動作 |
|------|------|
| 既存編集 | DBの保存データを表示（LocalStorageは参照しない） |

### 保存

| 操作 | 動作 |
|------|------|
| 銀の栞クリック | 定着の儀式（更新）開始 |
| 通信中 | 巻物が震える |
| 成功 | 定着の儀式 → 一覧画面へ（背表紙が光る） |
| 失敗 | sfx_glitch_dissonance.wav + エラー表示 |

---

## エラーハンドリング

エラーメッセージは `config/locales/ja.yml` 参照。

| 状況 | 対応 |
|------|------|
| バリデーションエラー | エラーメッセージ表示 |
| 通信エラー | sfx_glitch_dissonance.wav + エラーメッセージ表示 |

---

## API

### 夢更新

**エンドポイント**: `PUT /api/v1/dreams/:id`

**リクエスト**:
```json
{
  "dream": {
    "title": "更新後タイトル",
    "content": "更新後本文...",
    "emotion_color": "chaos",
    "lucid_dream_flag": true,
    "dreamed_at": "2025-01-15",
    "tag_attributes": [...]
  }
}
```

**レスポンス（成功: 200）**: 更新された夢データ

**レスポンス（失敗: 422）**: エラーメッセージ

---

## 演出

`animations.md` 参照。

- 巻物演出（展開・収束）
- 作成・編集画面（感情選択、羽ペン筆記音）
- 定着の儀式（更新・保存成功）
- 通信中（巻物が震える）
- 保存失敗

---

## 実装状況

- [ ] 巻物モーダルUI
- [ ] 既存データ読み込み
- [ ] 入力フォーム
- [ ] インク瓶（感情彩色選択）
- [ ] タグ入力・サジェスト
- [ ] 羽ペンカーソル・筆記音
- [ ] 定着の儀式（更新成功演出）
- [ ] 通信中・保存失敗演出
- [ ] エラーハンドリング
